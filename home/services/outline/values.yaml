app-template:
  image:
    repository: outlinewiki/outline
    tag: 0.69.1
  controller:
    type: deployment
    annotations:
      reloader.stakater.com/auto: "true"
  initContainers:
    migrations:
      image: outlinewiki/outline:0.69.1
      command: ["yarn", "sequelize", "db:migrate"]
      envFrom:
      - configMapRef:
          name: outline-env
  env:
    TZ: America/Chicago
    OIDC_SCOPES: "openid profile email"
    URL: https://<path:kv/data/ingress/hosts#outline>
    PORT: 3000
    REDIS_URL: redis://redis-master:6379
    AWS_REGION: local
    AWS_S3_ACL: private
    AWS_S3_FORCE_PATH_STYLE: '"true"'
    DATABASE_URL: postgres://postgres:<path:kv/data/postgresql#outline>@postgresql:5432/postgres
    OIDC_AUTH_URI: https://<path:kv/data/ingress/hosts#authentik>/application/o/authorize/
    OIDC_TOKEN_URI: https://<path:kv/data/ingress/hosts#authentik>/application/o/token/
    OIDC_USERINFO_URI: https://<path:kv/data/ingress/hosts#authentik>/application/o/userinfo/

  envFrom:
  - secretRef:
      name: outline-env
  service:
    main:
      ports:
        http:
          port: 80
          targetPort: 3000

postgresql:
  fullnameOverride: postgresql
  image:
    registry: docker.io
    repository: bitnami/postgresql
    tag: 14.8.0-debian-11-r7
  auth:
    postgresPassword: <path:kv/data/postgresql#outline>
  persistence:
    enabled: true

redis:
  fullnameOverride: redis
  image:
    registry: docker.io
    repository: bitnami/redis
    tag: 7.0.11
  architecture: standalone
  auth:
    enabled: false
  master:
    resources:
      requests:
        memory: 64Mi
    persistence:
      enabled: false

addons:
  virtualService:
    name: outline
    service: outline
    port: 80
