---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: minio
spec:
  interval: 5m
  chart:
    spec:
      chart: charts/kah-common
      sourceRef:
        kind: GitRepository
        name: flux-system
        namespace: flux-system
  values:
    global:
      nameOverride: minio
    image:
      repository: quay.io/minio/minio
      tag: RELEASE.2022-08-25T07-17-05Z
    env:
      TZ: America/Chicago
      MINIO_UPDATE: "off"
      MINIO_BROWSER_REDIRECT_URL: "https://minio.${CLUSTER_DOMAIN}"
      MINIO_SERVER_URL: "https://s3.${CLUSTER_DOMAIN}"
      MINIO_ROOT_USER: ${MINIO_ROOT_ACCESS_KEY}
      MINIO_ROOT_PASSWORD: ${MINIO_ROOT_SECRET_KEY}
    args:
    - server
    - /data
    - --console-address
    - :9001
    persistence:
      config:
        enabled: false
      data:
        enabled: true
        type: pvc
        mountPath: /data
        existingClaim: object-pool
    service:
      main:
        enabled: true
        ports:
          http:
            enabled: true
            port: 9001
          api:
            enabled: true
            port: 80
            targetPort: 9000
