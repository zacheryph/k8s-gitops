---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: minio
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://charts.min.io/
      chart: minio
      version: 4.0.13
      sourceRef:
        kind: HelmRepository
        name: minio
        namespace: flux-system
      interval: 5m
  values:
    image:
      repository: quay.io/minio/minio
      tag: RELEASE.2022-09-01T23-53-36Z
    mcImage:
      repository: quay.io/minio/mc
      tag: RELEASE.2022-09-01T23-53-36Z

    mode: standalone
    rootUser: ${MINIO_ROOT_ACCESS_KEY}
    rootPassword: ${MINIO_ROOT_SECRET_KEY}

    service:
      port: "80"
      targetPort: "9000"

    persistence:
      enabled: true
      existingClaim: sync-destination

    metrics:
      serviceMonitor:
        enabled: true

    policies:
    - name: volsync
      statements:
      - resources:
        - "arn:aws:s3:::volsync/*"
        actions:
        - "s3:*"

    users:
    - accessKey: ${VOLSYNC_S3_ACCESS_KEY}
      secretKey: ${VOLSYNC_S3_SECRET_KEY}
      policy: volsync

    buckets:
    - name: volsync
      policy: none
      purge: false
      versioning: false
      objectlocking: false

    resources:
      requests:
        memory: 350Mi
        cpu: 25m
      limits:
        memory: 1000Mi
